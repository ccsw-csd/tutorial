
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.2.5">
    
    
      
        <title>游릭 Springboot - Tutorial Frontend - Backend</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.2d9f7617.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#listado-filtrado-springboot" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../.." title="Tutorial Frontend - Backend" class="md-header__button md-logo" aria-label="Tutorial Frontend - Backend" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tutorial Frontend - Backend
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              游릭 Springboot
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B칰squeda" placeholder="B칰squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b칰squeda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegaci칩n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Tutorial Frontend - Backend" class="md-nav__button md-logo" aria-label="Tutorial Frontend - Backend" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Tutorial Frontend - Backend
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Bienvenido!
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../thanks/" class="md-nav__link">
        Agradecimientos!
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../usecases/" class="md-nav__link">
        Contexto de la aplicaci칩n
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_4">
          Entorno de desarrollo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Entorno de desarrollo" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Entorno de desarrollo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../install/angular/" class="md-nav__link">
        游댯 Angular
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../install/springboot/" class="md-nav__link">
        游릭 Springboot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../install/nodejs/" class="md-nav__link">
        游릭 Nodejs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Estructura y buenas pr치cticas
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Estructura y buenas pr치cticas" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Estructura y buenas pr치cticas
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cleancode/angular/" class="md-nav__link">
        游댯 Angular
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cleancode/springboot/" class="md-nav__link">
        游릭 Springboot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../cleancode/nodejs/" class="md-nav__link">
        游릭 Nodejs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_6">
          Code: Listado simple
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code: Listado simple" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Code: Listado simple
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/angular/" class="md-nav__link">
        游댯 Angular
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/springboot/" class="md-nav__link">
        游릭 Springboot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../basic/nodejs/" class="md-nav__link">
        游릭 Nodejs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_7">
          Code: Listado paginado
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code: Listado paginado" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Code: Listado paginado
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../paginated/angular/" class="md-nav__link">
        游댯 Angular
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../paginated/springboot/" class="md-nav__link">
        游릭 Springboot
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../paginated/nodejs/" class="md-nav__link">
        游릭 Nodejs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_8">
          Code: Listado filtrado
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Code: Listado filtrado" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Code: Listado filtrado
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../angular/" class="md-nav__link">
        游댯 Angular
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          游릭 Springboot
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        游릭 Springboot
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crear-modelos" class="md-nav__link">
    Crear Modelos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tdd-pruebas" class="md-nav__link">
    TDD - Pruebas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service" class="md-nav__link">
    Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prueba-de-las-operaciones" class="md-nav__link">
    Prueba de las operaciones
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementar-listado-autores" class="md-nav__link">
    Implementar listado Autores
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nodejs/" class="md-nav__link">
        游릭 Nodejs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../exercise/" class="md-nav__link">
        Ahora hazlo tu!
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_10">
          Anexos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Anexos" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          Anexos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/git/" class="md-nav__link">
        GIT: Tutorial b치sico
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/rest/" class="md-nav__link">
        API Rest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/tdd/" class="md-nav__link">
        TDD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../appendix/jpa/" class="md-nav__link">
        Spring Data: JPA
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crear-modelos" class="md-nav__link">
    Crear Modelos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tdd-pruebas" class="md-nav__link">
    TDD - Pruebas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#controller" class="md-nav__link">
    Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service" class="md-nav__link">
    Service
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#repository" class="md-nav__link">
    Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prueba-de-las-operaciones" class="md-nav__link">
    Prueba de las operaciones
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementar-listado-autores" class="md-nav__link">
    Implementar listado Autores
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="listado-filtrado-springboot">Listado filtrado - Springboot</h1>
<p>En este punto ya tenemos dos listados, uno b치sico y otro paginado. Ahora vamos a implementar un listado un poco diferente, este listado va a tener filtros de b칰squeda.</p>
<p>Como ya conocemos como se debe desarrollar, en este ejemplo vamos a ir m치s r치pidos y nos vamos a centrar 칰nicamente en las novedades.</p>
<h2 id="crear-modelos">Crear Modelos</h2>
<p>Lo primero que vamos a hacer es crear los modelos para trabajar con BBDD y con peticiones hacia el front. Adem치s, tambi칠n tenemos que a침adir datos al script de inicializaci칩n de BBDD.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">schema.sql</label><label for="__tabbed_1_2">data.sql</label><label for="__tabbed_1_3">Game.java</label><label for="__tabbed_1_4">GameDto.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">;</span><span class="w"></span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">CATEGORY</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>


<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">;</span><span class="w"></span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">AUTHOR</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">nationality</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>


<span class="hll"><span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n">GAME</span><span class="p">;</span><span class="w"></span>
</span>
<span class="hll"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">GAME</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">IDENTITY</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">250</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">age</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">category_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"></span>
</span><span class="hll"><span class="w">    </span><span class="n">author_id</span><span class="w"> </span><span class="nb">BIGINT</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="w"></span>
</span><span class="hll"><span class="p">);</span><span class="w"></span>
</span>
<span class="hll"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">GAME</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">category_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">GAME</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">);</span><span class="w"></span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Eurogames&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Ameritrash&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">CATEGORY</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Familiar&#39;</span><span class="p">);</span><span class="w"></span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Alan R. Moon&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;US&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Vital Lacerda&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;PT&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Simone Luciani&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;IT&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Perepau Llistosella&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;ES&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Michael Kiesling&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DE&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">AUTHOR</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">nationality</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Phil Walker-Harding&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;US&#39;</span><span class="p">);</span><span class="w"></span>

<span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;On Mars&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;14&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Aventureros al tren&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;1920: Wall Street&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;12&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Barrage&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;14&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Los viajes de Marco Polo&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;12&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"></span>
</span><span class="hll"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">GAME</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">author_id</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Azul&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;8&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span><span class="w"></span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Column</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.JoinColumn</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.ManyToOne</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Table</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.Author</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.Category</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Game&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Game</span> <span class="p">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="nd">@Column</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;age&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">age</span><span class="p">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;category_id&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Category</span> <span class="n">category</span><span class="p">;</span>

    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;author_id&quot;</span><span class="p">,</span> <span class="n">nullable</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
    <span class="kd">private</span> <span class="n">Author</span> <span class="n">author</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * @return id</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param id new value of {@link #getId}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return title</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param title new value of {@link #getTitle}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return age</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAge</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param age new value of {@link #getAge}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="p">(</span><span class="n">String</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return category</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">getCategory</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">category</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param category new value of {@link #getCategory}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="p">(</span><span class="n">Category</span> <span class="n">category</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return author</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">Author</span> <span class="nf">getAuthor</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">author</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param author new value of {@link #getAuthor}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="p">(</span><span class="n">Author</span> <span class="n">author</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game.model</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.CategoryDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameDto</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="n">Long</span> <span class="n">id</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">title</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">age</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">CategoryDto</span> <span class="n">category</span><span class="p">;</span>

    <span class="kd">private</span> <span class="n">AuthorDto</span> <span class="n">author</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * @return id</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">Long</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param id new value of {@link #getId}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return title</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param title new value of {@link #getTitle}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return age</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAge</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">age</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param age new value of {@link #getAge}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="p">(</span><span class="n">String</span> <span class="n">age</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return category</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">CategoryDto</span> <span class="nf">getCategory</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">category</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param category new value of {@link #getCategory}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCategory</span><span class="p">(</span><span class="n">CategoryDto</span> <span class="n">category</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @return author</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="n">AuthorDto</span> <span class="nf">getAuthor</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">author</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * @param author new value of {@link #getAuthor}.</span>
<span class="cm">    */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAuthor</span><span class="p">(</span><span class="n">AuthorDto</span> <span class="n">author</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">author</span> <span class="o">=</span> <span class="n">author</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Relaciones anidadas</p>
<p>F칤jate que tanto la <code>Entity</code> como el <code>Dto</code> tienen relaciones con <code>Author</code> y <code>Category</code>. Gracias a Spring JPA se pueden resolver de esta forma y tener toda la informaci칩n de las relaciones hijas dentro del objeto padre. Muy importante recordar que <em>en el mundo entity</em> las relaciones ser치n con objetos <code>Entity</code> mientras que <em>en el mundo dto</em> las relaciones deben ser siempre con objetos <code>Dto</code>. La utilidad beanMapper ya har치 las conversiones necesarias, siempre que tengan el mismo nombre de propiedades.</p>
</div>
<h2 id="tdd-pruebas">TDD - Pruebas</h2>
<p>Para desarrollar todas las operaciones, empezaremos primero dise침ando las pruebas y luego implementando el c칩digo necesario que haga funcionar correctamente esas pruebas. Para ir m치s r치pido vamos a poner todas las pruebas de golpe, pero realmente se deber칤an crear una a una e ir implementando el c칩digo necesario para esa prueba. Para evitar tantas iteraciones en el tutorial las haremos todas de golpe.</p>
<p>Vamos a pararnos a pensar un poco que necesitamos en la pantalla. En este caso solo tenemos dos operaciones:</p>
<ul>
<li>Una consulta filtrada, que reciba datos de filtro opcionales (t칤tulo e idCategor칤a) y devuelva los datos ya filtrados</li>
<li>Una operaci칩n de guardado y modificaci칩n</li>
</ul>
<p>De nuevo tendremos que desglosar esto en varios casos de prueba:</p>
<ul>
<li>Buscar un juego sin filtros</li>
<li>Buscar un t칤tulo que exista</li>
<li>Buscar una categor칤a que exista</li>
<li>Buscar un t칤tulo y una categor칤a que existan</li>
<li>Buscar un t칤tulo que no exista</li>
<li>Buscar una categor칤a que no exista</li>
<li>Buscar un t칤tulo y una categor칤a que no existan</li>
<li>Crear un juego nuevo (en realidad deber칤amos probar diferentes combinaciones y errores)</li>
<li>Modificar un juego que exista</li>
<li>Modificar un juego que no exista</li>
</ul>
<p>Tambi칠n crearemos una clase <code>GameController</code> dentro del package de <code>com.ccsw.tutorial.game</code> con la implementaci칩n de los m칠todos vac칤os, para que no falle la compilaci칩n.</p>
<p>춰Vamos a implementar test!</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">GameController.java</label><label for="__tabbed_2_2">GameIT.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>

<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameController</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">idCategory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">GameDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.CategoryDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.web.client.TestRestTemplate</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.web.server.LocalServerPort</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.core.ParameterizedTypeReference</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpEntity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.HttpStatus</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.http.ResponseEntity</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.annotation.DirtiesContext</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.util.UriComponentsBuilder</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.junit.jupiter.api.Assertions.*</span><span class="p">;</span>

<span class="nd">@SpringBootTest</span><span class="p">(</span><span class="n">webEnvironment</span> <span class="o">=</span> <span class="n">SpringBootTest</span><span class="p">.</span><span class="na">WebEnvironment</span><span class="p">.</span><span class="na">RANDOM_PORT</span><span class="p">)</span>
<span class="nd">@DirtiesContext</span><span class="p">(</span><span class="n">classMode</span> <span class="o">=</span> <span class="n">DirtiesContext</span><span class="p">.</span><span class="na">ClassMode</span><span class="p">.</span><span class="na">BEFORE_EACH_TEST_METHOD</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameIT</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">LOCALHOST</span> <span class="o">=</span> <span class="s">&quot;http://localhost:&quot;</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">SERVICE_PATH</span> <span class="o">=</span> <span class="s">&quot;/game/&quot;</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">EXISTS_GAME_ID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">NOT_EXISTS_GAME_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NOT_EXISTS_TITLE</span> <span class="o">=</span> <span class="s">&quot;NotExists&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">EXISTS_TITLE</span> <span class="o">=</span> <span class="s">&quot;Aventureros&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">NEW_TITLE</span> <span class="o">=</span> <span class="s">&quot;Nuevo juego&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">NOT_EXISTS_CATEGORY</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">EXISTS_CATEGORY</span> <span class="o">=</span> <span class="mi">3L</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">TITLE_PARAM</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">CATEGORY_ID_PARAM</span> <span class="o">=</span> <span class="s">&quot;idCategory&quot;</span><span class="p">;</span>

    <span class="nd">@LocalServerPort</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">TestRestTemplate</span> <span class="n">restTemplate</span><span class="p">;</span>

    <span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">responseType</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span><span class="p">(){};</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getUrlWithParams</span><span class="p">(){</span>
        <span class="k">return</span> <span class="n">UriComponentsBuilder</span><span class="p">.</span><span class="na">fromHttpUrl</span><span class="p">(</span><span class="n">LOCALHOST</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="n">SERVICE_PATH</span><span class="p">)</span>
        <span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="s">&quot;{&quot;</span> <span class="o">+</span> <span class="n">TITLE_PARAM</span> <span class="o">+</span><span class="s">&quot;}&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">queryParam</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="s">&quot;{&quot;</span> <span class="o">+</span> <span class="n">CATEGORY_ID_PARAM</span> <span class="o">+</span><span class="s">&quot;}&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="na">encode</span><span class="p">()</span>
        <span class="p">.</span><span class="na">toUriString</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findWithoutFiltersShouldReturnAllGamesInDB</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findExistsTitleShouldReturnGames</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findExistsCategoryShouldReturnGames</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findExistsTitleAndCategoryShouldReturnGames</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findNotExistsTitleShouldReturnEmpty</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findNotExistsCategoryShouldReturnEmpty</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">findNotExistsTitleOrCategoryShouldReturnEmpty</span><span class="p">()</span> <span class="p">{</span>

          <span class="kt">int</span> <span class="n">GAMES_WITH_FILTER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>
          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>

          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>
          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>

          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">EXISTS_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="n">NOT_EXISTS_CATEGORY</span><span class="p">);</span>

          <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>
          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">GAMES_WITH_FILTER</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveWithoutIdShouldCreateNewGame</span><span class="p">()</span> <span class="p">{</span>

          <span class="n">GameDto</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GameDto</span><span class="p">();</span>
          <span class="n">AuthorDto</span> <span class="n">authorDto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorDto</span><span class="p">();</span>
          <span class="n">authorDto</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>

          <span class="n">CategoryDto</span> <span class="n">categoryDto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CategoryDto</span><span class="p">();</span>
          <span class="n">categoryDto</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>

          <span class="n">dto</span><span class="p">.</span><span class="na">setTitle</span><span class="p">(</span><span class="n">NEW_TITLE</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="s">&quot;18&quot;</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setAuthor</span><span class="p">(</span><span class="n">authorDto</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setCategory</span><span class="p">(</span><span class="n">categoryDto</span><span class="p">);</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">NEW_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>

          <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">LOCALHOST</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="n">SERVICE_PATH</span><span class="p">,</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">PUT</span><span class="p">,</span> <span class="k">new</span> <span class="n">HttpEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">dto</span><span class="p">),</span> <span class="n">Void</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

          <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyWithExistIdShouldModifyGame</span><span class="p">()</span> <span class="p">{</span>

          <span class="n">GameDto</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GameDto</span><span class="p">();</span>
          <span class="n">AuthorDto</span> <span class="n">authorDto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AuthorDto</span><span class="p">();</span>
          <span class="n">authorDto</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>

          <span class="n">CategoryDto</span> <span class="n">categoryDto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CategoryDto</span><span class="p">();</span>
          <span class="n">categoryDto</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">1L</span><span class="p">);</span>

          <span class="n">dto</span><span class="p">.</span><span class="na">setTitle</span><span class="p">(</span><span class="n">NEW_TITLE</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setAge</span><span class="p">(</span><span class="s">&quot;18&quot;</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setAuthor</span><span class="p">(</span><span class="n">authorDto</span><span class="p">);</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setCategory</span><span class="p">(</span><span class="n">categoryDto</span><span class="p">);</span>

          <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">params</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">TITLE_PARAM</span><span class="p">,</span> <span class="n">NEW_TITLE</span><span class="p">);</span>
          <span class="n">params</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">CATEGORY_ID_PARAM</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>

          <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">LOCALHOST</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="n">SERVICE_PATH</span> <span class="o">+</span> <span class="n">EXISTS_GAME_ID</span><span class="p">,</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">PUT</span><span class="p">,</span> <span class="k">new</span> <span class="n">HttpEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">dto</span><span class="p">),</span> <span class="n">Void</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

          <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">getUrlWithParams</span><span class="p">(),</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseType</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>

          <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
          <span class="n">assertEquals</span><span class="p">(</span><span class="n">EXISTS_GAME_ID</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getId</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">modifyWithNotExistIdShouldThrowException</span><span class="p">()</span> <span class="p">{</span>

          <span class="n">GameDto</span> <span class="n">dto</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GameDto</span><span class="p">();</span>
          <span class="n">dto</span><span class="p">.</span><span class="na">setTitle</span><span class="p">(</span><span class="n">NEW_TITLE</span><span class="p">);</span>

          <span class="n">ResponseEntity</span><span class="o">&lt;?&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">LOCALHOST</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="n">SERVICE_PATH</span> <span class="o">+</span> <span class="n">NOT_EXISTS_GAME_ID</span><span class="p">,</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">PUT</span><span class="p">,</span> <span class="k">new</span> <span class="n">HttpEntity</span><span class="o">&lt;&gt;</span><span class="p">(</span><span class="n">dto</span><span class="p">),</span> <span class="n">Void</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

          <span class="n">assertEquals</span><span class="p">(</span><span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getStatusCode</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">B칰squedas en BBDD</p>
<p>Siempre deber칤amos buscar a los hijos por primary keys, nunca hay que hacerlo por una descripci칩n libre ya que el usuario podr칤a teclear el mismo nombre de diferentes formas y no habr칤a manera de buscar correctamente el resultado. As칤 que siempre que haya un dropdown, se debe filtrar por su ID.</p>
</div>
<p>Si ahora ejecutas los jUnits, ver치s que en este caso hemos construido 10 pruebas, para cubrir los casos b치sicos del <code>Controller</code>, y todas ellas fallan la ejecuci칩n. Vamos a seguir implementando el resto de capas para hacer que los test funcionen.</p>
<h2 id="controller">Controller</h2>
<p>De nuevo para poder compilar esta capa, nos hace falta delegar sus operaciones de l칩gica de negocio en un <code>Service</code> as칤 que lo crearemos al mismo tiempo que lo vamos necesitando.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">GameService.java</label><label for="__tabbed_3_2">GameController.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GameService</span> <span class="p">{</span>

    <span class="cm">/**</span>
<span class="cm">    * Recupera los juegos filtrando opcionalmente por t칤tulo y/o categor칤a</span>
<span class="cm">    * @param title</span>
<span class="cm">    * @param idCategory</span>
<span class="cm">    * @return</span>
<span class="cm">    */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">idCategory</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">    * Guarda o modifica un juego, dependiendo de si el id est치 o no informado</span>
<span class="cm">    * @param id</span>
<span class="cm">    * @param dto</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">GameDto</span> <span class="n">dto</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.CrossOrigin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestBody</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMethod</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.devonfw.module.beanmapping.common.api.BeanMapper</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="hll"><span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;/game&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="nd">@RestController</span>
</span><span class="hll"><span class="nd">@CrossOrigin</span><span class="p">(</span><span class="n">origins</span> <span class="o">=</span> <span class="s">&quot;*&quot;</span><span class="p">)</span>
</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameController</span> <span class="p">{</span>

<span class="hll">    <span class="nd">@Autowired</span>
</span><span class="hll">    <span class="n">GameService</span> <span class="n">gameService</span><span class="p">;</span>
</span>
<span class="hll">    <span class="nd">@Autowired</span>
</span><span class="hll">    <span class="n">BeanMapper</span> <span class="n">beanMapper</span><span class="p">;</span>
</span>
<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">GameDto</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;title&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">String</span> <span class="n">title</span><span class="p">,</span>
</span><span class="hll">            <span class="nd">@RequestParam</span><span class="p">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&quot;idCategory&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Long</span> <span class="n">idCategory</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="n">games</span> <span class="o">=</span> <span class="n">gameService</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">idCategory</span><span class="p">);</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">return</span> <span class="n">beanMapper</span><span class="p">.</span><span class="na">mapList</span><span class="p">(</span><span class="n">games</span><span class="p">,</span> <span class="n">GameDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="hll">    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;/{id}&quot;</span> <span class="p">},</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">PUT</span><span class="p">)</span>
</span><span class="hll">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="nd">@PathVariable</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="nd">@RequestBody</span> <span class="n">GameDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="n">gameService</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">dto</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>En esta ocasi칩n, para el m칠todo de b칰squeda hemos decidido utilizar par치metros en la URL de tal forma que nos quedar치 algo as칤 <code>http://localhost:8080/game/?title=xxx&amp;idCategoria=yyy</code>. Queremos recuperar el recurso <code>Game</code> que es el raiz de la ruta, pero filtrado por cero o varios par치metros.</p>
<h2 id="service">Service</h2>
<p>Siguiente paso, la capa de l칩gica de negocio, es decir el <code>Service</code>, que por tanto har치 uso de un <code>Repository</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">GameServiceImpl.java</label><label for="__tabbed_4_2">GameRepository.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.transaction.Transactional</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeanUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameServiceImpl</span> <span class="kd">implements</span> <span class="n">GameService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">GameRepository</span> <span class="n">gameRepository</span><span class="p">;</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">category</span><span class="p">)</span> <span class="p">{</span>

<span class="hll">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">category</span><span class="p">);</span>
</span>    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">GameDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Game</span> <span class="n">game</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
            <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Game</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="n">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="hll">        <span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">dto</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;category&quot;</span><span class="p">);</span>
</span>
        <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">game</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GameRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Game</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">category</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Este servicio tiene dos peculiaridades, remarcadas en amarillo en la clase anterior. Por un lado tenemos la consulta, que no es un listado completo ni un listado paginado, sino que es un listado con filtros. Luego veremos como se hace eso, de momento lo dejaremos como un m칠todo que recibe los dos filtros.</p>
<p>La segunda peculiaridad es que de cliente nos est치 llegando un <code>GameDto</code>, que internamente tiene un <code>AuthorDto</code> y un <code>CategoryDto</code>, pero nosotros lo tenemos que traducir a entidades de BBDD. No sirve con copiar las propiedades tal cual, ya que entonces Spring lo que har치 ser치 crear un objeto nuevo y persistir ese objeto nuevo de <code>Author</code> y de <code>Category</code>. Adem치s, de cliente generalmente tan solo nos llega el ID de esos objetos hijo, y no el resto de informaci칩n de la entidad. Por esos motivos lo hemos <em>ignorado</em> del copyProperties.</p>
<p>Pero de alguna forma tendremos que setearle esos valores a la entidad <code>Game</code>. Si conocemos sus ID que es lo que generalmente llega, podemos recuperar esos objetos de BBDD y setearlos en el objeto <code>Game</code>. Si recuerdas las reglas b치sicas, un <code>Repository</code> debe pertenecer a un solo <code>Service</code>, por lo que en lugar de llamar a m칠todos de los <code>AuthorRepository</code> y <code>CategoryRepository</code> desde nuestro <code>GameServiceImpl</code>, debemos llamar a m칠todos expuestos en <code>AuthorService</code> y <code>CategoryService</code>, que son los que gestionan sus repositorios. Para ello necesitaremos crear esos m칠todos get en los otros <code>Services</code>. </p>
<p>Y ya sabes, para implementar nuevos m칠todos, antes se deben hacer las pruebas jUnit, que en este caso, por variar, cubriremos con pruebas unitarias. Recuerda que los test van en <code>src/test/java</code></p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><input id="__tabbed_5_3" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">AuthorTest.java</label><label for="__tabbed_5_2">AuthorService.java</label><label for="__tabbed_5_3">AuthorServiceImpl.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.author</span><span class="p">;</span>

<span class="kn">import static</span> <span class="nn">org.junit.jupiter.api.Assertions.assertEquals</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.jupiter.api.Assertions.assertNotNull</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.junit.jupiter.api.Assertions.assertNull</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.mockito.Mockito.mock</span><span class="p">;</span>
<span class="kn">import static</span> <span class="nn">org.mockito.Mockito.when</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.Test</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.junit.jupiter.api.extension.ExtendWith</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.mockito.InjectMocks</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.mockito.Mock</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.mockito.junit.jupiter.MockitoExtension</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.Author</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.Optional</span><span class="p">;</span>

<span class="nd">@ExtendWith</span><span class="p">(</span><span class="n">MockitoExtension</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorTest</span> <span class="p">{</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">EXISTS_AUTHOR_ID</span> <span class="o">=</span> <span class="mi">1L</span><span class="p">;</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">NOT_EXISTS_AUTHOR_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="p">;</span>

   <span class="nd">@Mock</span>
   <span class="kd">private</span> <span class="n">AuthorRepository</span> <span class="n">authorRepository</span><span class="p">;</span>

   <span class="nd">@InjectMocks</span>
   <span class="kd">private</span> <span class="n">AuthorServiceImpl</span> <span class="n">authorService</span><span class="p">;</span>

   <span class="nd">@Test</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getExistsAuthorIdShouldReturnAuthor</span><span class="p">()</span> <span class="p">{</span>

      <span class="n">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Author</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span><span class="n">author</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">EXISTS_AUTHOR_ID</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span><span class="n">authorRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">EXISTS_AUTHOR_ID</span><span class="p">)).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">author</span><span class="p">));</span>

      <span class="n">Author</span> <span class="n">authorResponse</span> <span class="o">=</span> <span class="n">authorService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">EXISTS_AUTHOR_ID</span><span class="p">);</span>

      <span class="n">assertNotNull</span><span class="p">(</span><span class="n">authorResponse</span><span class="p">);</span>

      <span class="n">assertEquals</span><span class="p">(</span><span class="n">EXISTS_AUTHOR_ID</span><span class="p">,</span> <span class="n">authorResponse</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
   <span class="p">}</span>

   <span class="nd">@Test</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getNotExistsAuthorIdShouldReturnNull</span><span class="p">()</span> <span class="p">{</span>

      <span class="n">when</span><span class="p">(</span><span class="n">authorRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">NOT_EXISTS_AUTHOR_ID</span><span class="p">)).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">());</span>

      <span class="n">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="n">authorService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">NOT_EXISTS_AUTHOR_ID</span><span class="p">);</span>

      <span class="n">assertNull</span><span class="p">(</span><span class="n">author</span><span class="p">);</span>
   <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.author</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.Author</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorSearchDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AuthorService</span> <span class="p">{</span>

<span class="hll">    <span class="cm">/**</span>
</span><span class="hll"><span class="cm">    * Recupera un {@link com.ccsw.tutorial.author.model.Author} a trav칠s de su ID</span>
</span><span class="hll"><span class="cm">    * @param id</span>
</span><span class="hll"><span class="cm">    * @return</span>
</span><span class="hll"><span class="cm">    */</span>
</span><span class="hll">    <span class="n">Author</span> <span class="nf">get</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">);</span>
</span>
    <span class="cm">/**</span>
<span class="cm">    * M칠todo para recuperar un listado paginado de {@link com.ccsw.tutorial.author.model.Author}</span>
<span class="cm">    * @param dto</span>
<span class="cm">    * @return</span>
<span class="cm">    */</span>
    <span class="n">Page</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="nf">findPage</span><span class="p">(</span><span class="n">AuthorSearchDto</span> <span class="n">dto</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">    * M칠todo para crear o actualizar un {@link com.ccsw.tutorial.author.model.Author}</span>
<span class="cm">    * @param id</span>
<span class="cm">    * @param data</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">AuthorDto</span> <span class="n">data</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">    * M칠todo para crear o actualizar un {@link com.ccsw.tutorial.author.model.Author}</span>
<span class="cm">    * @param id</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.author</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.transaction.Transactional</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeanUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.data.domain.Page</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.Author</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorDto</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.model.AuthorSearchDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthorServiceImpl</span> <span class="kd">implements</span> <span class="n">AuthorService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">AuthorRepository</span> <span class="n">authorRepository</span><span class="p">;</span>

<span class="hll">    <span class="cm">/**</span>
</span><span class="hll"><span class="cm">    * {@inheritDoc}</span>
</span><span class="hll"><span class="cm">    */</span>
</span><span class="hll">    <span class="nd">@Override</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">Author</span> <span class="nf">get</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">authorRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Page</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="nf">findPage</span><span class="p">(</span><span class="n">AuthorSearchDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">authorRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">dto</span><span class="p">.</span><span class="na">getPageable</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">AuthorDto</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Author</span> <span class="n">author</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
<span class="hll">            <span class="n">author</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span>        <span class="k">else</span>
            <span class="n">author</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Author</span><span class="p">();</span>

        <span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">author</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="na">authorRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">author</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">authorRepository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="p">}</span>

<span class="p">}</span>    
</code></pre></div>
</div>
</div>
</div>
<p>Y lo mismo para categor칤as.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:3"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><input id="__tabbed_6_3" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">CategoryTest.java</label><label for="__tabbed_6_2">CategoryService.java</label><label for="__tabbed_6_3">CategoryServiceImpl.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">NOT_EXISTS_CATEGORY_ID</span> <span class="o">=</span> <span class="mi">0</span><span class="n">L</span><span class="p">;</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getExistsCategoryIdShouldReturnCategory</span><span class="p">()</span> <span class="p">{</span>

      <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">mock</span><span class="p">(</span><span class="n">Category</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span><span class="n">category</span><span class="p">.</span><span class="na">getId</span><span class="p">()).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">EXISTS_CATEGORY_ID</span><span class="p">);</span>
      <span class="n">when</span><span class="p">(</span><span class="n">categoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">EXISTS_CATEGORY_ID</span><span class="p">)).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">category</span><span class="p">));</span>

      <span class="n">Category</span> <span class="n">categoryResponse</span> <span class="o">=</span> <span class="n">categoryService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">EXISTS_CATEGORY_ID</span><span class="p">);</span>

      <span class="n">assertNotNull</span><span class="p">(</span><span class="n">categoryResponse</span><span class="p">);</span>
      <span class="n">assertEquals</span><span class="p">(</span><span class="n">EXISTS_CATEGORY_ID</span><span class="p">,</span> <span class="n">category</span><span class="p">.</span><span class="na">getId</span><span class="p">());</span>
<span class="p">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getNotExistsCategoryIdShouldReturnNull</span><span class="p">()</span> <span class="p">{</span>

      <span class="n">when</span><span class="p">(</span><span class="n">categoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">NOT_EXISTS_CATEGORY_ID</span><span class="p">)).</span><span class="na">thenReturn</span><span class="p">(</span><span class="n">Optional</span><span class="p">.</span><span class="na">empty</span><span class="p">());</span>

      <span class="n">Category</span> <span class="n">category</span> <span class="o">=</span> <span class="n">categoryService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">NOT_EXISTS_CATEGORY_ID</span><span class="p">);</span>

      <span class="n">assertNull</span><span class="p">(</span><span class="n">category</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.category</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.Category</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.CategoryDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CategoryService</span> <span class="p">{</span>

<span class="hll">    <span class="cm">/**</span>
</span><span class="hll"><span class="cm">    * Recupera una {@link com.ccsw.tutorial.category.model.Category} a partir de su ID</span>
</span><span class="hll"><span class="cm">    * @param id</span>
</span><span class="hll"><span class="cm">    * @return</span>
</span><span class="hll"><span class="cm">    */</span>
</span><span class="hll">    <span class="n">Category</span> <span class="nf">get</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">);</span>
</span>
    <span class="cm">/**</span>
<span class="cm">    * M칠todo para recuperar todas las {@link com.ccsw.tutorial.category.model.Category}</span>
<span class="cm">    * @return</span>
<span class="cm">    */</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

    <span class="cm">/**</span>
<span class="cm">    * M칠todo para crear o actualizar una {@link com.ccsw.tutorial.category.model.Category}</span>
<span class="cm">    * @param dto</span>
<span class="cm">    * @return</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">CategoryDto</span> <span class="n">dto</span><span class="p">);</span>

    <span class="cm">/**</span>
<span class="cm">    * M칠todo para borrar una {@link com.ccsw.tutorial.category.model.Category}</span>
<span class="cm">    * @param id</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.category</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.Category</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.model.CategoryDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CategoryServiceImpl</span> <span class="kd">implements</span> <span class="n">CategoryService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">CategoryRepository</span> <span class="n">categoryRepository</span><span class="p">;</span>

<span class="hll">    <span class="cm">/**</span>
</span><span class="hll"><span class="cm">    * {@inheritDoc}</span>
</span><span class="hll"><span class="cm">    */</span>
</span><span class="hll">    <span class="nd">@Override</span>
</span><span class="hll">    <span class="kd">public</span> <span class="n">Category</span> <span class="nf">get</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span><span class="hll">
</span><span class="hll">        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">categoryRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span><span class="hll">    <span class="p">}</span>
</span>
    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Category</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="na">categoryRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">CategoryDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Category</span> <span class="n">categoria</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
            <span class="n">categoria</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Category</span><span class="p">();</span>
        <span class="k">else</span>
<span class="hll">            <span class="n">categoria</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span>
        <span class="n">categoria</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="n">dto</span><span class="p">.</span><span class="na">getName</span><span class="p">());</span>

        <span class="k">this</span><span class="p">.</span><span class="na">categoryRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">categoria</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="na">categoryRepository</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Clean Code</p>
<p>A la hora de implementar m칠todos nuevos, ten siempre presente el <code>Clean Code</code>. 춰No dupliques c칩digo!, es muy importante de cara al futuro mantenimiento. Si en nuestro m칠todo <code>save</code> hac칤amos uso de una operaci칩n <code>findById</code> y ahora hemos creado una nueva operaci칩n <code>get</code>, hagamos uso de esta nueva operaci칩n y no repitamos el c칩digo.</p>
</div>
<p>Y ahora que ya tenemos los m칠todos necesarios ya podemos implementar correctamente nuestro <code>GameServiceImpl</code>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">GameServiceImpl.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.transaction.Transactional</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeanUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.author.AuthorService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.category.CategoryService</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.GameDto</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* @author ccsw</span>
<span class="cm">*/</span>
<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GameServiceImpl</span> <span class="kd">implements</span> <span class="n">GameService</span> <span class="p">{</span>

    <span class="nd">@Autowired</span>
    <span class="n">GameRepository</span> <span class="n">gameRepository</span><span class="p">;</span>

<span class="hll">    <span class="nd">@Autowired</span>
</span><span class="hll">    <span class="n">AuthorService</span> <span class="n">authorService</span><span class="p">;</span>
</span>
<span class="hll">    <span class="nd">@Autowired</span>
</span><span class="hll">    <span class="n">CategoryService</span> <span class="n">categoryService</span><span class="p">;</span>
</span>
    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">category</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">category</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">    * {@inheritDoc}</span>
<span class="cm">    */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Long</span> <span class="n">id</span><span class="p">,</span> <span class="n">GameDto</span> <span class="n">dto</span><span class="p">)</span> <span class="p">{</span>

        <span class="n">Game</span> <span class="n">game</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
            <span class="n">game</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Game</span><span class="p">();</span>
        <span class="k">else</span>
            <span class="n">game</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="n">id</span><span class="p">).</span><span class="na">orElse</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

        <span class="n">BeanUtils</span><span class="p">.</span><span class="na">copyProperties</span><span class="p">(</span><span class="n">dto</span><span class="p">,</span> <span class="n">game</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">,</span> <span class="s">&quot;author&quot;</span><span class="p">,</span> <span class="s">&quot;category&quot;</span><span class="p">);</span>

<span class="hll">        <span class="n">game</span><span class="p">.</span><span class="na">setAuthor</span><span class="p">(</span><span class="n">authorService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">dto</span><span class="p">.</span><span class="na">getAuthor</span><span class="p">().</span><span class="na">getId</span><span class="p">()));</span>
</span><span class="hll">        <span class="n">game</span><span class="p">.</span><span class="na">setCategory</span><span class="p">(</span><span class="n">categoryService</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">dto</span><span class="p">.</span><span class="na">getCategory</span><span class="p">().</span><span class="na">getId</span><span class="p">()));</span>
</span>
        <span class="k">this</span><span class="p">.</span><span class="na">gameRepository</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">game</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Ahora si que tenemos la capa de l칩gica de negocio terminada, podemos pasar a la siguiente capa.</p>
<h2 id="repository">Repository</h2>
<p>Y llegamos a la 칰ltima capa donde, si recordamos, ten칤amos un m칠todo <code>find</code> que recibe dos par치metros. Algo as칤:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">GameRepository.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GameRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Game</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="n">Long</span> <span class="n">category</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Para esta ocasi칩n, vamos a necesitar un listado filtrado por t칤tulo o por categor칤a, as칤 que necesitaremos pasarle esos datos y filtrar la query. Para el t칤tulo vamos a buscar por una cadena contenida, as칤 que el par치metro ser치 de tipo <code>String</code>, mientras que para la categor칤a vamos a buscar por su primary key, as칤 que el par치metro ser치 de tipo <code>Long</code>.</p>
<p>Existen varias estrategias para abordar esta implementaci칩n. Podr칤amos utilizar los <a href="https://www.baeldung.com/spring-data-derived-queries">QueryMethods</a> para que Spring JPA haga su magia, pero en esta ocasi칩n ser칤a bastante complicado encontrar un predicado correcto.</p>
<p>Tambi칠n podr칤amos hacer una implementaci칩n de la interface y hacer la consulta directamente con Criteria. Pero en esta ocasi칩n vamos a utilizar otra <em>magia</em> que nos ofrece Spring JPA y es utilizar la <a href="https://www.baeldung.com/spring-data-jpa-query">anotaci칩n @Query</a>.</p>
<p>Esta anotaci칩n nos permite definir una consulta en SQL nativo o en JPQL (Java Persistence Query Language) y Spring JPA se encargar치 de realizar todo el mapeo y conversi칩n de los datos de entrada y salida. Veamos un ejemplo y luego lo explicamos en detalle:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">GameRepository.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">package</span> <span class="nn">com.ccsw.tutorial.game</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.data.repository.CrudRepository</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.ccsw.tutorial.game.model.Game</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">GameRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">Game</span><span class="p">,</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="p">{</span>

<span class="hll">    <span class="nd">@Query</span><span class="p">(</span><span class="s">&quot;select g from Game g where (:title is null or g.title like &#39;%&#39;||:title||&#39;%&#39;) and (:category is null or g.category.id = :category)&quot;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">List</span><span class="o">&lt;</span><span class="n">Game</span><span class="o">&gt;</span> <span class="nf">find</span><span class="p">(</span><span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)</span> <span class="n">String</span> <span class="n">title</span><span class="p">,</span> <span class="nd">@Param</span><span class="p">(</span><span class="s">&quot;category&quot;</span><span class="p">)</span> <span class="n">Long</span> <span class="n">category</span><span class="p">);</span>
</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>Si te fijas en las dos l칤neas que hemos modificado, por un lado hemos puesto nombre a los par치metros de entrada con la anotaci칩n @Param. Esto solo nos sirve para poder utilizar los parametros dentro de la query.</p>
<p>Por otro lado, hemos creado una query en un lenguaje similar a SQL, pero en lugar de hacer uso de tablas y columnas, hacemos uso de objetos entity y propiedades. Dentro del where hemos puesto las dos condiciones, o bien que el par치metro t칤tulo sea nulo o bien si no es nulo, que la propiedad contenga el texto del par치metro t칤tulo. Para categor칤a hemos hecho lo mismo. 
Con esta quuery, Spring JPA generar치 el SQL correcto y mapear치 los resultados a un listado de <code>Game</code> que es lo que queremos obtener.</p>
<p>Es otra forma, bastante sencilla de implementar consultas a BBDD.</p>
<h2 id="prueba-de-las-operaciones">Prueba de las operaciones</h2>
<p>Si ahora ejecutamos de nuevo los jUnits, vemos que todos los que hemos desarrollado en <code>GameIT</code> ya funcionan correctamente, e incluso el resto de test de la aplicaci칩n tambi칠n funcionan correctamente. </p>
<div class="admonition tip">
<p class="admonition-title">Pruebas jUnit</p>
<p>Cada vez que desarrollemos un caso de uso nuevo, debemos relanzar todas las pruebas autom치ticas que tenga la aplicaci칩n. Es muy com칰n que al implementar alg칰n desarrollo nuevo, interfiramos de alguna forma en el funcionamiento de otra funcionalidad. Si lanzamos toda la bater칤a de pruebas, nos daremos cuenta si algo ha dejado de funcionar y podremos solucionarlo antes de llevar ese error a Producci칩n. Las pruebas jUnit son nuestra red de seguridad.</p>
</div>
<p>Adem치s de las pruebas autom치ticas, podemos ver como se comporta la aplicaci칩n y que respuesta nos ofrece, lanzando peticiones Rest con Postman, como hemos hecho en los casos anteriores. As칤 que podemos levantar la aplicaci칩n y lanzar las operaciones:</p>
<p><strong> GET http://localhost:8080/game </strong> </p>
<p><strong> GET http://localhost:8080/game?title=xxx </strong></p>
<p><strong> GET http://localhost:8080/game?idCategory=xxx </strong></p>
<p>Nos devuelve un listado filtrado de <code>Game</code>. F칤jate bien en la petici칩n donde enviamos los filtros y la respuesta que tiene los objetos <code>Category</code> y <code>Author</code> inclu칤dos.</p>
<p><img alt="step5-java1" src="../../../assets/images/step5-java1.png" /></p>
<p><strong> PUT http://localhost:8080/game </strong> 
<strong> PUT http://localhost:8080/game/{id} </strong> </p>
<div class="highlight"><pre><span></span><code>{
    &quot;title&quot;: &quot;Nuevo juego&quot;,
    &quot;age&quot;: &quot;18&quot;,
    &quot;category&quot;: {
        &quot;id&quot;: 3
    },
    &quot;author&quot;: {
        &quot;id&quot;: 1
    }
}
</code></pre></div>
<p>Nos sirve para insertar un <code>Game</code> nuevo (si no tienen el id informado) o para actualizar un <code>Game</code> (si tienen el id informado). F칤jate que para enlazar <code>Category</code> y <code>Author</code> tan solo hace falta el id de cada no de ellos, ya que en el m칠todo <code>save</code> se hace una consulta <code>get</code> para recuperarlos por su id. Adem치s que no tendr칤a sentido enviar toda la informaci칩n de esas entidades ya que no est치s dando de alta una <code>Category</code> ni un <code>Author</code>.</p>
<p><img alt="step5-java2" src="../../../assets/images/step5-java2.png" />
<img alt="step5-java3" src="../../../assets/images/step5-java3.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Rendimiento en las consultas JPA</p>
<p>En este punto te recomiendo que visites el <a href="../../../appendix/jpa/">Anexo. Funcionamiento JPA</a> para conocer un poco m치s como funciona por dentro JPA y alg칰n peque침o truco que puede mejorar el rendimiento.</p>
</div>
<h2 id="implementar-listado-autores">Implementar listado Autores</h2>
<p>Antes de poder conectar front con back, si recuerdas, en la edici칩n de un <code>Game</code>, nos hac칤a falta un listado de <code>Author</code> y un listado de <code>Category</code>. El segundo ya lo tenemos ya que lo reutilizaremos del listado de categor칤as que implementamos. Pero el primero no lo tenemos, porque en la pantalla que hicimos, se mostraban de forma paginada. </p>
<p>As칤 que necesitamos implementar esa funcionalidad, y como siempre vamos de la capa de testing hacia las siguientes capas. Deber칤amos a침adir los siguientes m칠todos:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:4"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><input id="__tabbed_10_3" name="__tabbed_10" type="radio" /><input id="__tabbed_10_4" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">AuthorIT.java</label><label for="__tabbed_10_2">AuthorController.java</label><label for="__tabbed_10_3">AuthorService.java</label><label for="__tabbed_10_4">AuthorServiceImpl.java</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">...</span>

<span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AuthorDto</span><span class="o">&gt;&gt;</span> <span class="n">responseTypeList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ParameterizedTypeReference</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AuthorDto</span><span class="o">&gt;&gt;</span><span class="p">(){};</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">findAllShouldReturnAllAuthor</span><span class="p">()</span> <span class="p">{</span>

      <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">AuthorDto</span><span class="o">&gt;&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="p">.</span><span class="na">exchange</span><span class="p">(</span><span class="n">LOCALHOST</span> <span class="o">+</span> <span class="n">port</span> <span class="o">+</span> <span class="n">SERVICE_PATH</span><span class="p">,</span> <span class="n">HttpMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="n">responseTypeList</span><span class="p">);</span>

      <span class="n">assertNotNull</span><span class="p">(</span><span class="n">response</span><span class="p">);</span>
      <span class="n">assertEquals</span><span class="p">(</span><span class="n">TOTAL_AUTHORS</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="na">getBody</span><span class="p">().</span><span class="na">size</span><span class="p">());</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">...</span>

<span class="cm">/**</span>
<span class="cm">* Recupera un listado de autores</span>
<span class="cm">* @return</span>
<span class="cm">*/</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">GET</span><span class="p">)</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">AuthorDto</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="n">authors</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="na">authorService</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="na">beanMapper</span><span class="p">.</span><span class="na">mapList</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="n">AuthorDto</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">...</span>

<span class="cm">/**</span>
<span class="cm">* Recupera un listado de autores</span>
<span class="cm">* @return</span>
<span class="cm">*/</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">();</span>

<span class="p">...</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="p">...</span>

<span class="cm">/**</span>
<span class="cm">* {@inheritDoc}</span>
<span class="cm">*/</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span> <span class="nf">findAll</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Author</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="na">authorRepository</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
<span class="p">}</span>


<span class="p">...</span>
</code></pre></div>
</div>
</div>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Pie">
      
        
        <a href="../angular/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: 游댯 Angular" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              游댯 Angular
            </div>
          </div>
        </a>
      
      
        
        <a href="../nodejs/" class="md-footer__link md-footer__link--next" aria-label="Siguiente: 游릭 Nodejs" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Siguiente
              </span>
              游릭 Nodejs
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.path", "navigation.indexes"], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../../../assets/javascripts/workers/search.bd0b6b67.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.467223ff.min.js"></script>
      
    
  </body>
</html>